<odoo>
  <data>
    <record id="res_partner_inherit" model="ir.ui.view">
      <field name="name">res.partner.inherit</field>
      <field name="model">res.partner</field>
      <field name="inherit_id" ref="base.view_partner_form" />
      <field name="arch" type="xml">
        <xpath expr="//form//sheet" position="before">
          <header>
            <!-- <button name="%(scan_dl_wizard)d" string="Scan DL" type="action" class="btn-primary"/> -->
            <button name="check_in" string="Check In" type="object" class="btn-primary" invisible="not context.get('check_in_window',False) or context.get('has_caregiver',False)" />
            <button name="check_in_as_patient" string="Check In Patient" type="object" class="btn-primary" invisible="not (context.get('check_in_window',False) and context.get('has_caregiver',False))" />
          </header>
        </xpath>
        <field name="type" position="after">
          <field name="pref_name" string="Preferred Name" />
        </field>
        <field name="vat" position="after">
          <!-- <field name="is_medical" string="Is Medical" invisible="1" /> -->
          <!-- <field name="customer_type" string="Customer Type" /> -->
          <field name="medical_id" string="Medical ID" widget="formatted_char" required="context.get('has_caregiver')"/>
          <field name="medical_expiration" string="Medical ID Expiration" required="context.get('has_caregiver')"/>
          <field name="date_of_birth" string="DOB" />
          <field name="is_over_21" string="21+" invisible="1" />
          <field name="is_expired_medical" string="Expired Medical" invisible="1" />
          <field name="is_expired_dl" string="Expired DL" invisible="1" />
          <field name="drivers_license_number" string="Drivers #" />
          <field name="drivers_license_expiration" string="DL Expiration" />
          <button name="warn" string="Issue Warning" type="object" class="btn btn-secondary oe_edit_only" />
          <button name="unwarn" string="Remove Warning" type="object" class="btn btn-secondary oe_edit_only" />
          <field name="is_banned" invisible="1" />
          <field name="warnings" invisible="1" />
          <div>
            <div role="img" id="oe_hr_attendance_status" class="fa fa-fw fa-circle o_button_icon" style="color: gold;" attrs="{'invisible': [('warnings', '&lt;', '1')]}" aria-label="Warning 1" title="Warning 1" />
            <div role="img" id="oe_hr_attendance_status" class="fa fa-fw fa-circle o_button_icon" style="color: orange;" attrs="{'invisible': [('warnings', '&lt;', '2')]}" aria-label="Warning 2" title="Warning 2" />
            <div role="img" id="oe_hr_attendance_status" class="fa fa-fw fa-circle o_button_icon" style="color: red;" attrs="{'invisible': [('warnings', '&lt;', '3')]}" aria-label="Warning 3" title="Warning 3" />
          </div>
        </field>
        <field name="image_1920" position="before">
          <widget name="web_ribbon" title="Medical Licence Expired" bg_color="bg-warning" attrs="{'invisible': ['|',('is_expired_medical', '=', False),('medical_id','in',[False,''])]}" />
          <widget name="web_ribbon" title="Drivers Licence Expired" bg_color="bg-warning" attrs="{'invisible': [('is_expired_dl','=',False)]}" />
          <widget name="web_ribbon" title="Banned" bg_color="bg-danger" attrs="{'invisible': [('is_banned', '=', False)]}" />
        </field>
        <field name="category_id" position="attributes">
          <attribute name="string">Customer Groups</attribute>
          <attribute name="placeholder">Groups...</attribute>
        </field>
        <!-- <field name="category_id" position="before"> -->
          <!-- <field name="caregiver"/> -->
          <!-- <field name="caregiver_number" string="Caregiver ID"/> -->
        <!-- </field> -->
        <field name="category_id" position="after">
          <field name="passport" />
        </field>
        <!-- Replace fields we don't need to show -->
        <field name="vat" position="attributes">
          <attribute name="invisible">1</attribute>
        </field>
        <field name="company_type" position="attributes" >
          <attribute name="invisible">1</attribute>
        </field>
        <field name="function" position="attributes">
          <attribute name="invisible">1</attribute>
        </field>
        <field name="website" position="attributes">
          <attribute name="invisible">1</attribute>
        </field>
        <field name="title" position="attributes">
          <attribute name="invisible">1</attribute>
        </field>
        <field name="parent_id" position="attributes">
          <attribute name="invisible">1</attribute>
        </field>
        <!-- Replace the tabs -->
        <xpath expr="//notebook/page[@name='contact_addresses']" position="attributes">
          <attribute name="invisible">1</attribute>
        </xpath>
        <xpath expr="//notebook/page[@name='sales_purchases']" position="attributes">
          <attribute name="invisible">1</attribute>
        </xpath>
        <xpath expr="//notebook/page[@name='accounting']" position="attributes">
          <attribute name="invisible">1</attribute>
        </xpath>
        <xpath expr="//notebook/page[@name='accounting_disabled']" position="attributes">
          <attribute name="invisible">1</attribute>
        </xpath>

        <xpath expr="//notebook/page[@name='internal_notes']" position="before">
          <page name="documents_and_images" string="Documents and Images">
            <!-- Will probably look something like the original contacts tab -->
            <!-- <field name="document_ids"/> -->
          </page>
        </xpath>
        <!-- Replace smart buttons -->
        <xpath expr="//div[@class='oe_button_box']" position="replace">
          <div class="oe_button_box" name="button_box">
            <button class="oe_stat_button" type="action" name="%(lume_sales.order_history)d" icon="fa-usd" modifiers="{}" options="{}">
              <field string="Order History" name="sale_order_count" widget="statinfo" modifiers="{'readonly':true}" id="sale_order_count" />
            </button>
            <!-- <button class="oe_stat_button" type="action" name="%(project.project_task_action_from_partner)d"
                        context="{'search_default_partner_id': active_id, 'default_partner_id': active_id}" attrs="{'invisible': [('task_count', '=', 0)]}"
                        icon="fa-tasks">
                        <field  string="Tasks" name="task_count" widget="statinfo"/>
                    </button> -->
          </div>
        </xpath>
        <xpath expr="//div[@class='oe_chatter']" position="replace">
          <div class="oe_chatter">
            <!--<field name="message_follower_ids"/>-->
            <!--<field name="activity_ids"/>-->
            <field name="message_ids" />
          </div>
        </xpath>
        <field name="category_id" position="before">
          <field name="is_caregiver" string="Caregiver"></field>
          <field name="caregiver_id" attrs="{'invisible':[('is_caregiver','=',True)],'domain':[('is_caregiver','=',True)]}"></field>
          <field name="caregiver_license" string="Caregiver Medical ID" widget="formatted_char" attrs="{'invisible':[('is_caregiver','=',False)],'required':[('is_caregiver','=',True)]}"></field>
          <field name="patient_ids" domain="[('is_caregiver','=',False)]" attrs="{'invisible':[('is_caregiver','=',False)],'required':[('is_caregiver','=',True)]}" widget="many2many" context="{'tree_view_ref':'lume_sales.patient_list_view','check_in_window':context.get('check_in_window'),'has_caregiver':True,'project_id':context.get('project_id'),'fulfillment_type':context.get('fulfillment_type')}">
            <tree>
              <field name="name"/>
              <field name="medical_id"/>
              <field name="medical_expiration"/>
              <!-- <field name="caregiver_id"/> -->
              <!-- Can put button here to check in a patient -->
              <!-- <button name="check_in_as_patient" string="Check In" type="object" class="btn-primary" invisible="not context.get('check_in_window',False)" /> -->
              <control>
                <create string="Add Patient"/>
              </control>
            </tree>
          </field>
        </field>
        <xpath expr="//notebook/page[@name='internal_notes']/*" position="before">
          <field name="note_ids">
            <tree>
              <field name="message"/>
              <field name="logged_partner_id"/>
            </tree>
          </field>
        </xpath>
        <field name="phone" position="attributes">
          <attribute name="required">1</attribute>
        </field>
        <xpath expr="//span[@name='address_name']" position="replace">
          <span class="o_form_label o_td_label" name="address_name">
            <b>Address</b>
          </span>
        </xpath>
      </field>
    </record>

    <record id="patient_list_view"  model="ir.ui.view">
      <field name="name">lume_sales.patient</field>
      <field name="model">res.partner</field>
      <!-- <field name="inherit_id" ref="base.view_partner_form" /> -->
      <field name="arch" type="xml">
        <tree>
          <field name="name"/>
          <field name="medical_id"/>
          <field name="medical_expiration"/>
          <field name="caregiver_id"/>
        </tree>
      </field>
    </record>

    <!-- Partner search view -->
    <record id="lume_partner_search" model="ir.ui.view">
      <field name="active" eval="True"/>
      <field name="arch" type="xml">
        <data>
          <xpath expr="//search[1]/field[@name='name']" position="after">
            <field name="medical_id"/>
          </xpath>
        </data>
      </field>
      <field name="inherit_id" ref="base.view_res_partner_filter"/>
      <field name="mode">extension</field>
      <field name="model">res.partner</field>
      <field name="name">lume.partner.search</field>
      <field name="priority">99</field>
      <field name="type">search</field>
    </record>
  </data>
</odoo>